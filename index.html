<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON2XLSX</title>
</head>

<body>



    <!-- Plakadan Şehire -->

    <!-- <input type="number" name="" id="plaka">
                    <input type="button" value="tıkla" id="submit" onclick="plaka_to_sehir(plaka_number.value);">

                    <script>
                        let plaka_number = document.getElementById("plaka");
                        let submit_button = document.getElementById("submit");

                        function plaka_to_sehir(plaka) {
                            let sehirler = ['Adana', 'Adıyaman', 'Afyon', 'Ağrı', 'Amasya', 'Ankara', 'Antalya', 'Artvin', 'Aydın', 'Balıkesir', 'Bilecik', 'Bingöl', 'Bitlis', 'Bolu', 'Burdur', 'Bursa', 'Çanakkale', 'Çankırı', 'Çorum', 'Denizli', 'Diyarbakır', 'Edirne', 'Elazığ', 'Erzincan', 'Erzurum', 'Eskişehir', 'Gaziantep', 'Giresun', 'Gümüşhane', 'Hakkari', 'Hatay', 'Isparta', 'Mersin', 'İstanbul', 'İzmir', 'Kars', 'Kastamonu', 'Kayseri', 'Kırklareli', 'Kırşehir', 'Kocaeli', 'Konya', 'Kütahya', 'Malatya', 'Manisa', 'Kahramanmaraş', 'Mardin', 'Muğla', 'Muş', 'Nevşehir', 'Niğde', 'Ordu', 'Rize', 'Sakarya', 'Samsun', 'Siirt', 'Sinop', 'Sivas', 'Tekirdağ', 'Tokat', 'Trabzon', 'Tunceli', 'Şanlıurfa', 'Uşak', 'Van', 'Yozgat', 'Zonguldak', 'Aksaray', 'Bayburt', 'Karaman', 'Kırıkkale', 'Batman', 'Şırnak', 'Bartın', 'Ardahan', 'Iğdır', 'Yalova', 'Karabük', 'Kilis', 'Osmaniye', 'Düzce']

                            return sehirler[plaka - 1]
                        }
                    </script> -->


    <script src="xlsx.js"></script>
    <script src="FileSaver.js"></script>

    <script>
        let json_dosyasi = [{
            "meterIdentityId": 80024439,
            "meterDate": "2021-11-15T06:04:15.131Z",
            "meterFactorValue": 55,
            "currentRateFactorValue": 40,
            "voltageRateFactorValue": 47,
            "loadProfileDate": "2021-03-04T09:37:54.588Z",
            "positiveT0Value": 121,
            "positiveRiValue": 122,
            "positiveRcValue": 123,
            "negativeT0Value": 124,
            "negativeRiValue": 125,
            "negativeRcValue": 126,
            "currentL1Value": 127,
            "currentL2Value": 128,
            "currentL3Value": 129,
            "voltageL1Value": 130,
            "voltageL2Value": 131,
            "voltageL3Value": 132
        }, {
            "meterIdentityId": 80024439,
            "meterDate": "2021-11-15T06:04:15.131Z",
            "meterFactorValue": 55,
            "currentRateFactorValue": 40,
            "voltageRateFactorValue": 47,
            "loadProfileDate": "2021-03-04T09:37:54.588Z",
            "positiveT0Value": 121,
            "positiveRiValue": 122,
            "positiveRcValue": 123,
            "negativeT0Value": 124,
            "negativeRiValue": 125,
            "negativeRcValue": 126,
            "currentL1Value": 127,
            "currentL2Value": 128,
            "currentL3Value": 129,
            "voltageL1Value": 130,
            "voltageL2Value": 131,
            "voltageL3Value": 132
        }, {
            "meterIdentityId": 80024439,
            "meterDate": "2021-11-15T06:04:15.131Z",
            "meterFactorValue": 55,
            "currentRateFactorValue": 40,
            "voltageRateFactorValue": 47,
            "loadProfileDate": "2021-03-04T09:37:54.588Z",
            "positiveT0Value": 121,
            "positiveRiValue": 122,
            "positiveRcValue": 123,
            "negativeT0Value": 124,
            "negativeRiValue": 125,
            "negativeRcValue": 126,
            "currentL1Value": 127,
            "currentL2Value": 128,
            "currentL3Value": 129,
            "voltageL1Value": 130,
            "voltageL2Value": 131,
            "voltageL3Value": 132
        }, {
            "meterIdentityId": 80024439,
            "meterDate": "2021-11-15T06:04:15.131Z",
            "meterFactorValue": 55,
            "currentRateFactorValue": 40,
            "voltageRateFactorValue": 47,
            "loadProfileDate": "2021-03-04T09:37:54.588Z",
            "positiveT0Value": 121,
            "positiveRiValue": 122,
            "positiveRcValue": 123,
            "negativeT0Value": 124,
            "negativeRiValue": 125,
            "negativeRcValue": 126,
            "currentL1Value": 127,
            "currentL2Value": 128,
            "currentL3Value": 129,
            "voltageL1Value": 130,
            "voltageL2Value": 131,
            "voltageL3Value": 132
        }, {
            "meterIdentityId": 80024439,
            "meterDate": "2021-11-15T06:04:15.131Z",
            "meterFactorValue": 55,
            "currentRateFactorValue": 40,
            "voltageRateFactorValue": 47,
            "loadProfileDate": "2021-03-04T09:37:54.588Z",
            "positiveT0Value": 121,
            "positiveRiValue": 122,
            "positiveRcValue": 123,
            "negativeT0Value": 124,
            "negativeRiValue": 125,
            "negativeRcValue": 126,
            "currentL1Value": 127,
            "currentL2Value": 128,
            "currentL3Value": 129,
            "voltageL1Value": 130,
            "voltageL2Value": 131,
            "voltageL3Value": 132
        }]

        function rows_of_sheet(json_dosyasi) {
            const rows = [];
            for (let i = 0; i < json_dosyasi.length; i++) {
                rows[i] = []
                if (i == 0) {
                    let titles = []
                    for (let x = 0; x < Object.keys(json_dosyasi[i]).length; x++) {
                        titles.push(Object.keys(json_dosyasi[i])[x])
                    }
                    rows[i].push(titles);
                } else {
                    rows[i].push([json_dosyasi[i].meterIdentityId, json_dosyasi[i].meterDate, json_dosyasi[i].meterFactorValue, json_dosyasi[i].currentRateFactorValue], json_dosyasi[i].voltageRateFactorValue, json_dosyasi[i].loadProfileDate, json_dosyasi[i].positiveT0Value, json_dosyasi[i].positiveRiValue, json_dosyasi[i].positiveRcValue, json_dosyasi[i].negativeT0Value, json_dosyasi[i].negativeRiValue, json_dosyasi[i].negativeRcValue, json_dosyasi[i].currentL1Value, json_dosyasi[i].currentL2Value, json_dosyasi[i].currentL3Value, json_dosyasi[i].voltageL1Value, json_dosyasi[i].voltageL2Value, json_dosyasi[i].voltageL3Value, );
                }
            }
            return rows;
        }

        function json_to_csv(json_dosyasi, rows) {


            let csvContent = "data:text/csv;charset=utf-8,";

            rows.forEach(function(rowArray) {
                let row = rowArray.join(",");
                csvContent += row + "\r\n";
            });

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "result.csv");
            document.body.appendChild(link); // Required for FF

            link.click();
        }

        function json_to_xlsx(json_dosyasi, rows) {
            var wb = XLSX.utils.book_new();

            wb.Props = {
                Title: "Deneme1",
                Subject: "Test",
                Author: "Javascript",
                CreatedDate: new Date(2006, 11, 1)
            };

            wb.SheetNames.push("Test Sheet");
            var ws_data = rows; //a row with 2 columns
            var ws = XLSX.utils.aoa_to_sheet(ws_data);
            wb.Sheets["Test Sheet"] = ws;
            var wbout = XLSX.write(wb, {
                bookType: 'xlsx',
                type: 'binary'
            });



            console.log("submited")
            saveAs(new Blob([s2ab(wbout)], {
                type: "application/octet-stream"
            }), 'test.xlsx');

        }

        function s2ab(s) {
            var buf = new ArrayBuffer(s.length); //convert s to arrayBuffer
            var view = new Uint8Array(buf); //create uint8array as viewer
            for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF; //convert to octet
            console.log("s2ab")
            return buf;

        }

        function calculate_mins_between_two_dates(date1, date2) {
            date1 = date1.replaceAll("-", "/").replaceAll("T", " ").replaceAll("Z", "")
            date2 = date2.replaceAll("-", "/").replaceAll("T", " ").replaceAll("Z", "")

            date1 = new Date(date1)
            date2 = new Date(date2)

            var diff = Math.abs(date1 - date2);
            var minutes = (diff / 1000) / 60

            return (minutes)
        }

        function name(date) {
            console.log(date)
            day = date.replaceAll("T", " ").replaceAll("Z", "").split(" ")[0].split("-")[2] + "." + date.replaceAll("T", " ").replaceAll("Z", "").split(" ")[0].split("-")[1] + "." + date.replaceAll("T", " ").replaceAll("Z", "").split(" ")[0].split("-")[0]
            time = date.replaceAll("T", " ").replaceAll("Z", "").split(" ")[1].split(".")[0]
            return day + " " + time
        }
        //burdaki T ve Z ne ?
        console.log(name("2021-03-04T09:30:54.588Z"))
    </script>




</body>

</html>